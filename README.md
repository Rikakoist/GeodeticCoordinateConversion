# GeodeticCoordinateConversion
大地坐标转换练习程序

## 一、功能需求
- 实现地理经纬度（或高斯投影平面坐标）的文本文件导入；
- 实现地理坐标到平面投影坐标的自动（和批量）计算；
- 实现计算成果的文本文件输出；
- 实现 6 度带和 3 度带坐标的换带计算。

## 二、功能模块设计
本程序包含以下功能：
- 坐标转换计算功能（地理坐标与高斯坐标互相转换）；
- 换带计算功能（3°带与6°带互相转换）；
- 数据库及文件存取功能（数据库及文件存取、数据库转换到文件）；
- 配置文件功能（用户配置数据的存取）。

## 三、类设计
本程序中的类有：
- 坐标转换类；
- 数据库管理类；
- 文件管理类；
- 数据处理类；
- 窗体控制类；
- 消息框管理类；
- 对象定义类；
- 程序入口类。

### 3.1 坐标转换类设计
本类通过接收用户输入的坐标数据，根据其类型调用相应的转换方法将其转换为对应的坐标数据，并将结果暂存于程序界面上的数据框中。具体表现为：
- 若用户输入的数据为地理经纬度，则将其转换为用户指定分带的高斯投影平面坐标并显示在选项卡1中数据框内对应的列中。
- 若用户输入的数据为高斯投影平面坐标（在选项卡1中），则将其转换为地理经纬度并显示在选项卡1中数据框内对应的列中。
- 若用户输入的数据为高斯投影平面坐标（在选项卡2中），则先将其转换为地理经纬度，再转换为另一分带方法下的高斯投影平面坐标并显示在选项卡2中数据框内对应的列中。

### 3.2 数据库管理类设计
本类通过接收用户输入的数据库操作及其类型，来调用对应的数据库方法，并将返回操作结果暂存于程序界面上的数据框中。有以下几种情况：
- 若用户执行的是查询操作，则通过用户输入的路径与表、查询条件来对数据库进行查询操作，并将返回的结果显示在选项卡3内的数据框中。
- 若用户执行的是插入操作，则通过用户输入的路径与表、插入条件来对数据库进行插入操作，这之后，再对同一路径下的同一表执行一次查询操作。
- 若用户执行的是删除操作，则通过用户输入的路径与表、删除条件来对数据库进行删除操作，这之后，再对同一路径下的同一表执行一次查询操作。
- 若用户执行的是更新操作，则通过用户输入的路径与表、更新条件来对数据库进行更新操作，这之后，再对同一路径下的同一表执行一次查询操作。

### 3.3 文件管理类设计
本类通过接收用户输入的文件操作及其类型，来调用对应的文件方法。有以下几种情况：
- 读取操作：通过用户输入的文件路径，对文件进行读取操作，并将返回的结果暂存于程序界面上对应选项卡中的数据框内。
- 保存操作：通过用户输入的文件路径，对文件进行保存操作，并将返回的结果显示在程序界面左下角用于提示的工具条按钮上。

### 3.4 数据处理类设计
本类不直接接收用户输入，但接受本程序内其他类中方法的调用。

### 3.5 窗体控制类设计
本类与程序主窗体关联，并通过与控件绑定的事件来和其余类交互。

### 3.6 消息框管理类设计
本类用于统一管理程序会用到的消息框，方法的名称即为其用途。

### 3.7 对象定义类设计
本类用于对象的定义，各对象类及其字段如下：
#### Ellipse
椭球对象。包含椭球的长、短半轴，第一、第二偏心率及极点处子午线曲率半径（暂未使用）字段。类型均为双精度浮点数。用于存储计算过程中使用的椭球参数。
#### DMS
角度对象。包含度、分、秒三个双精度浮点数字段。用于存储程序中所有度分秒类型的角度数据。
#### BL
地理经纬度对象。包含两个类型为DMS的字段B和L。用于存储程序中的地理经纬度数据。
#### GaussCoord
高斯投影平面坐标对象。包含分带类型、带号两个整型字段及中央经线、x坐标、y坐标三个双精度浮点型字段。用于存储程序中的高斯投影平面坐标数据。
#### DEC
十进制角度对象。包含带号整型字段及经度、纬度、中央经线三个双精度浮点型字段。用于存储程序中所有十进制类型的角度数据。
#### Tab1File
选项卡1暂存变量对象。包含一个类型为BL的字段及一个类型为GaussCoord的字段。用作文件及数据库操作时选项卡1的变量暂存。
#### Tab2File
选项卡2暂存变量对象。包含两个类型为GaussCoord的字段。用作文件及数据库操作时选项卡2的变量暂存。

## 四、详细设计
### 4.1 坐标转换计算功能模块设计
用户通过单击选项卡1中的转换按钮进行操作。按钮共有两个，其Clicks事件绑定到同一个方法Tab1GeoGauss。根据用户点击按钮的不同（sender不同）来调用不同坐标转换的方式。
#### 1、坐标转换管理方法
通过将椭球、引用的地理经纬度列表、引用的高斯投影平面坐标列表、转换模式和分带类型输入坐标转换管理方法，该方法将根据输入的参数调用不同的子方法。<br>
  //预备转换
  internal static void GaussPrepare(Ellipse E, ref List<GaussCoord> GC, ref List<BL> BLDMS, int Mode, int ZoneType)
  {
    switch (Mode)
            {
                case 0:  //Mode 0正算
                    {
                        GC = GaussDirect(DMSList2DEC(BLDMS), E.a, E.e, E.e2, ZoneType);
                        break;
                    }
                case 1:  //Mode 1反算
                    {
                        BLDMS = GaussReverse(GC, E.a, E.e, E.e2);
                        break;
                    }
                default:
                    {
                        throw new Exception("正反算参数错误。");
                    }
            }
        }
若输入的Mode参数为0，则执行高斯正算；若Mode参数为1，则执行高斯反算；若Mode参数为其他值，则抛出参数错误异常。
#### 2、高斯投影正算方法
本方法接收一个十进制的地理经纬度列表、椭球基本参数以及要转换到的分带类型，返回一个目标分带的高斯投影平面坐标列表。
#### 3、高斯投影反算方法
本方法接收一个高斯投影平面坐标列表及椭球基本参数，返回一个地理经纬度列表。

### 4.2 换带计算功能模块设计
本模块包含3度带转6度带及6度带转3度带功能。用户通过单击选项卡2中的换带按钮进行操作。按钮共有两个，其Click事件绑定到同一个方法ZoneConvert。根据用户点击按钮的不同（sender不同）来调用不同换带的方式。<br>
对于3度带转6度带，先调用高斯投影反算方法将3度带高斯投影坐标转换为地理经纬度，再调用高斯投影正算方法将所得结果转换为6度带高斯投影坐标。同理可得6度带转3度带过程。

### 4.3 数据库及文件存取功能模块设计
本模块包含数据库操作子模块、文件操作子模块和数据库转换到文件子模块。本模块的前两个子模块由窗体中的DataManagement方法操作。<br>
下面分别对三个模块进行介绍。
#### 4.3.1 数据库操作模块设计
本模块根据用户目前选中的选项卡和使用的不同按钮来执行不同操作。<br>
若为顶部菜单栏中数据库操作按钮触发的事件，则根据用户当前选中的选项卡对对应的数据框进行数据库存取操作；若为数据库操作选项卡中按钮触发，则调用DBIO.cs中的方法进行操作。
#### 4.3.2 文件操作模块设计
本模块根据用户目前选中的选项卡和使用的不同按钮来执行不同操作。<br>
若为顶部菜单栏中文件操作按钮触发的事件，则根据用户当前选中的选项卡，通过调用FileIO.cs中方法对对应的数据框进行文件存取操作。
#### 4.3.3 数据库转换到文件模块设计
本模块用于将数据库中的表导出到文件。根据用户选择数据库中表的不同将其导出到文件。

### 4.4 配置文件功能模块设计
本模块能够保存用户的偏好（椭球选择、分带方式、工作文件夹等），在程序启动时读取配置文件（若不存在则创建新的），在程序退出时保存配置文件，无需用户干预。
